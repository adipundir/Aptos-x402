# ARC-8004: Agent Trust Layer

## What is ARC-8004?

ARC-8004 is an **Agent Trust Layer** for Aptos, inspired by ERC-8004 on Ethereum. It provides three core components for establishing trust in AI agent ecosystems:

1. **Identity** - Verifiable on-chain identities for AI agents
2. **Reputation** - Trust scores based on interaction feedback
3. **Validation** - Task completion verification before payments

## Why ARC-8004?

In a world where AI agents handle payments and sensitive operations, trust is critical:

| Problem | ARC-8004 Solution |
|---------|-------------------|
| How do I know this agent is legitimate? | **Identity NFTs** - Each agent gets a unique on-chain identity |
| Is this agent reliable? | **Reputation scores** - Trust levels based on past interactions |
| Did the agent complete the task? | **Validation registry** - Verify task completion before payment |
| Can I trust agents for high-value transactions? | **Trust levels** - Filter agents by EXCELLENT, GOOD, FAIR, etc. |

## Architecture Overview

```
┌─────────────────────────────────────────────────────────────┐
│                    ARC-8004 Trust Layer                      │
├─────────────────┬──────────────────┬────────────────────────┤
│   Identity      │   Reputation     │   Validation           │
│   Registry      │   Registry       │   Registry             │
├─────────────────┼──────────────────┼────────────────────────┤
│ • Agent Cards   │ • Trust Scores   │ • Task Validation      │
│ • NFT Minting   │ • Feedback       │ • Pre-payment Checks   │
│ • Verification  │ • History        │ • Multi-validator      │
└─────────────────┴──────────────────┴────────────────────────┘
                           │
                           ▼
              ┌────────────────────────┐
              │   Aptos Blockchain     │
              │   (Move Contracts)     │
              └────────────────────────┘
```

## The Three Registries

### 1. Identity Registry

Every agent gets an **Agent Card** - a structured identity that can be minted as an NFT on Aptos:

```typescript
interface AgentCard {
  name: string;           // "WeatherBot"
  description: string;    // "Fetches real-time weather data"
  version: string;        // "1.0.0"
  owner: {
    address: string;      // Aptos wallet address
    publicKey: string;    // For verification
  };
  capabilities: string[]; // ["payment", "data-fetch"]
  protocols: string[];    // ["x402", "http"]
  supportedNetworks: string[]; // ["aptos-testnet"]
}
```

**Key features:**
- **Verified status** - Admin-verified agents get a trust badge
- **On-chain NFT** - Identity stored permanently on Aptos
- **Token address** - Unique identifier for the agent's identity NFT

### 2. Reputation Registry

Tracks agent trustworthiness through feedback:

```typescript
interface AgentReputation {
  agentId: string;
  overallScore: number;      // 0-5 average rating
  totalFeedback: number;     // Number of ratings
  trustLevel: TrustLevel;    // EXCELLENT, GOOD, FAIR, POOR, UNKNOWN
  categories: {
    reliability: number;     // 0-5
    speed: number;           // 0-5
    accuracy: number;        // 0-5
    value: number;           // 0-5
  };
}
```

**Trust Levels:**
| Level | Score Range | Description |
|-------|-------------|-------------|
| EXCELLENT | 4.5 - 5.0 | Top-tier, highly trusted |
| GOOD | 3.5 - 4.5 | Reliable, recommended |
| FAIR | 2.5 - 3.5 | Acceptable, some concerns |
| POOR | 1.0 - 2.5 | Problematic, use caution |
| UNKNOWN | < 1.0 or new | Insufficient data |

### 3. Validation Registry

Verify task completion before releasing payments:

```typescript
interface TaskValidation {
  taskId: string;
  agentId: string;
  status: 'pending' | 'approved' | 'rejected';
  validatedBy: string[];     // Validator addresses
  validationProof?: string;  // On-chain proof
  createdAt: Date;
  validatedAt?: Date;
}
```

**Use cases:**
- Escrow-style payments (pay only after validation)
- Multi-validator approval workflows
- SLA compliance verification

## On-Chain vs Off-Chain

ARC-8004 is designed to work **primarily off-chain** (in your database), with **optional** on-chain features:

| Feature | Off-Chain (DB) | On-Chain (Aptos) |
|---------|----------------|------------------|
| Agent identity registration | ✅ Always | Optional NFT |
| Agent Card metadata | ✅ Always | Stored in NFT |
| Reputation scores | ✅ Always | ❌ Not on-chain |
| Task validation | ✅ Always | ❌ Not on-chain |
| Verification badge | ✅ DB flag | Optional on-chain |

**For most users:** Just use DB mode. You get all the trust features without blockchain complexity.

```bash
# .env - DB-only mode (default, recommended)
ARC8004_ONCHAIN_ENABLED=false
ARC8004_AUTO_REGISTER=true
```

**For on-chain NFTs:** Enable on-chain mode to mint agent identities as Aptos NFTs.

```bash
# .env - On-chain mode
ARC8004_MODULE_ADDRESS=0xa4d7e1f...  # Testnet deployment
ARC8004_ONCHAIN_ENABLED=true
```

> **Note:** On-chain *verification* (the verified badge) is admin-only. See the [Integration Guide](/docs/guides/arc8004) for details.

## Verification Model

**Important:** On-chain verification is **admin-only** by design.

```move
// From agent_identity.move
public entry fun verify_identity(admin: &signer, token_address: address) {
    let registry = borrow_global<IdentityRegistry>(@arc8004);
    assert!(registry.admin == signer::address_of(admin), E_NOT_AUTHORIZED);
    // ... verification logic
}
```

**Why admin-only?**
- Prevents spam and fake verifications
- Ensures trusted verification authority
- Maintains integrity of the trust ecosystem

**Options for verification:**
1. **Platform users** - Request verification from Aptos-x402 admins
2. **SDK users** - Deploy your own contracts and become your own admin

## Integration with x402

ARC-8004 integrates seamlessly with x402 payments:

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   Client     │────▶│   Server     │────▶│  Facilitator │
│              │     │  (x402)      │     │              │
└──────────────┘     └──────────────┘     └──────────────┘
                            │
                            ▼
                    ┌──────────────┐
                    │   ARC-8004   │
                    │ Trust Check  │
                    └──────────────┘
```

**Flow:**
1. Client makes x402 payment request
2. Server checks agent identity/reputation via ARC-8004
3. If trusted, process payment via facilitator
4. After payment, submit feedback to reputation registry
5. For task-based payments, validate completion first

## Quick Start

See the following guides:
- [ARC-8004 Integration Guide](/docs/guides/arc8004) - Full SDK usage
- [ARC-8004 Use Cases](/docs/guides/arc8004-use-cases) - Practical examples
- [Self-Hosting ARC-8004](/docs/guides/arc8004-self-hosting) - Deploy your own contracts

## Testnet Deployment

Current testnet contracts:

| Module | Address |
|--------|---------|
| Identity | `0xa4d7e1f47887dc6b84743297164fdd63deaa872329f8617be1d4c87375d39323::agent_identity` |
| Reputation | `0xa4d7e1f47887dc6b84743297164fdd63deaa872329f8617be1d4c87375d39323::reputation` |
| Validation | `0xa4d7e1f47887dc6b84743297164fdd63deaa872329f8617be1d4c87375d39323::validation` |

## Summary

ARC-8004 provides the trust infrastructure needed for AI agent ecosystems:

- ✅ **Identity** - Know who you're dealing with
- ✅ **Reputation** - Know how reliable they are  
- ✅ **Validation** - Know tasks are completed
- ✅ **On-chain** - Permanent, verifiable records on Aptos
- ✅ **Integrated** - Works seamlessly with x402 payments
